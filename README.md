<div align="center">

# üì¶Ô∏è Packlet

[![TypeScript](https://img.shields.io/badge/TypeScript-%23007ACC.svg?logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Bun](https://img.shields.io/badge/Bun-%23000000.svg?logo=bun&logoColor=white)](https://bun.sh)<br />
![Conventional Commits](https://img.shields.io/badge/commit-conventional-blue.svg)
[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)
![license](https://img.shields.io/github/license/kazvizian/packlet-js)<br />
[![Turborepo](https://img.shields.io/badge/-Turborepo-EF4444?logo=turborepo&logoColor=white)](https://turbo.build)
[![Changesets Butterfly](https://img.shields.io/badge/Changesets-ü¶ã-white)](./CHANGELOG.md)
[![Biome Linter & Formatted](https://img.shields.io/badge/Biome-60a5fa?style=flat&logo=biome&logoColor=white)](https://biomejs.dev/)

[![gzip size](http://img.badgesize.io/https://unpkg.com/packlet@latest/dist/index.mjs?compression=gzip)](https://unpkg.com/packlet@latest/dist/index.mjs)

</div>

A concise toolkit for packaging and creating deterministic release artifacts.

## Packages

- `@packlet/core` ‚Äì Core utilities: artifact manifest, validation, name derivation, copy helpers
- `@packlet/gpr` ‚Äì Tools for preparing GitHub Packages (GPR) scoped variants and tarballs
- `@packlet/cli` ‚Äì Unified CLI exposing `packlet` commands (`gpr`, `validate`, `list-artifacts`)
- `@packlet/build` ‚Äì Lightweight build wrapper (ESM+CJS+d.ts) usable in any TS/JS package

## Philosophy

- Deterministic packing and artifact generation belong to `packlet`.
- Orchestration and publishing (CI, tokens, releases) are handled by `sailet` ‚Äî see related docs in `docs/`.
- Both interact through a stable `artifacts.json` manifest.

## Quick Start (monorepo)

```sh
# install & build
bun install
bun run build

# prepare a GPR variant and output a JSON manifest
node packages/cli/dist/index.mjs gpr --root packages/gpr --json

# list artifacts (human or JSON output)
node packages/cli/dist/index.mjs list-artifacts --artifacts packages/gpr/.artifacts
node packages/cli/dist/index.mjs list-artifacts --artifacts packages/gpr/.artifacts --json

# validate dist
node packages/cli/dist/index.mjs validate --root packages/gpr --json
```

## Build system

All packages are built with the lightweight wrapper `@packlet/build`, which standardizes:

- ESM outputs: `dist/index.mjs` (CJS available via `--cjs` when explicitly requested)
- Type declarations: `dist/index.d.ts` via `tsc --emitDeclarationOnly`
- Minification: enabled by default (use `--no-minify` to disable during debugging)

Typical package scripts:

```json
{
  "scripts": {
    "build": "node packages/build/dist/cli.mjs build --sourcemap none --external-auto",
    "build:cli": "node packages/build/dist/cli.mjs build --cjs --exec-js --sourcemap none --external-auto"
  },
  "devDependencies": {
    "@packlet/build": "workspace:*"
  }
}
```

For CLI packages (including the umbrella `packlet` and `@packlet/cli`), `--exec-js` marks the built entry executable (prefers `index.mjs`).

## Changelogs

Each package maintains its own `CHANGELOG.md` generated by Changesets during real releases. The umbrella `packlet` package contains an aggregate changelog that summarizes notable changes across all packages; it is populated only when a release is performed. This keeps history clear while avoiding noise between releases.

## CLI Commands (`packlet`)

- `packlet build` ‚Äì Build ESM + CJS outputs and emit `.d.ts` (flags: `--entry`, `--outdir`, `--formats`, `--sourcemap`, `--no-types`, `--target`, `--exec-js`, `--no-minify`)
- `packlet gpr` ‚Äì Prepare a GPR-staged package and tarballs
  Flags: `--root`, `--gpr-dir`, `--artifacts`, `--dist`, `--scope`, `--registry`, `--name`,
  `--include-readme`, `--no-include-readme`, `--include-license`, `--no-include-license`,
  `--json`, `--manifest <file>`

- `packlet validate` ‚Äì Verify required dist entries (`index.js`, `index.mjs`, `index.d.ts`)

- `packlet list-artifacts` ‚Äì List all `.tgz` files in an artifacts directory

> [!NOTE]
>
> `@packlet/gpr` also provides a lightweight `prepare` subcommand (mainly for CI or testing).
> It conditionally stages the GPR variant if `packlet.gpr` is enabled and `dist/` exists.
> Supported flags: `--root`, `--dist`, `--gpr-dir`, `--artifacts`, `--scope`, `--registry`, `--name`,
> with optional `--json` and `--manifest <file>` for machine-readable output.

## Artifacts Manifest

Running `packlet gpr` generates `<root>/.artifacts/artifacts.json`:

```json
{
  "schemaVersion": 1,
  "packageName": "<base-name>",
  "scopedName": "@<scope>/<base-name>",
  "version": "<semver>",
  "artifacts": [
    { "file": "<name>-<version>.tgz", "size": 12345, "sha512": "..." }
  ]
}
```

## Name Derivation (for GPR)

Base name is determined by the following priority:

1. `--name` flag or `GPR_NAME` environment variable
2. Repository name from `package.json.repository`
3. `package.json.name` (scope stripped)

## Developer Notes

Temporary test fixtures are created under `.temp/` and cleaned up automatically.

## License

MIT ¬© KazViz
